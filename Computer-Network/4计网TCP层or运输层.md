# 概述

+ **进程**：通信的真正主体

+ 复用(multiplesing)     ：发送方不同应用进程都可使用同一个运输层协议传送数据

  分用(demultiplexing)：接收方运输层在剥去报文首部后能够把数据正确交付目的的应用进程
  
+  ![](https://cdn.jsdelivr.net/gh/zweix123/CS-notes@master/source/Computer-Network/逻辑通信.png)

  + 网络层为主机之间提供逻辑通信

    运输层为应用进程之间提供端到端的逻辑通信

  + 运输层向高层用户屏蔽了下面网络核心的细节（网络拓扑、路由选择协议），使应用进程“看前来像”两个运输层实体之间的一条端到端的逻辑通信信道

+ 两个对等传输实体在通信时传送的数据单位：

  OSI：运输协议数据单元TPDU(Transport Protocol Data Unit)

  TCP/IP：TCP报文段(segment)/UDP用户数据报

## 协议

> 运输层新增第三种协议：流控制传输协议SCTP(Stream Control Transmission Protcol)[RFC 4960]

1. 用户数据报协议UDP(User Datagram Protocol)[RFC 768]
2. 传输控制协议TCP(Transmission Control Protoocol)[RFC 793]

| UDP        | TCP            |
| ---------- | -------------- |
| 无连接     | 面向连接       |
| 不可靠信道 | 全双工可靠信道 |

![](https://cdn.jsdelivr.net/gh/zweix123/CS-notes@master/source/Computer-Network/应用及其协议.png)

## 端口号

协议端口号(protocol prot number)，简称端口(port)：

> 1. 复用和分用的过程需要标志
>
> 2. > 计算机OS中使用进程标识符（小整数）
>
> 3. 计算机网络中不可以
>
>    1. OS类型多，标识符种类多
>
> 4. 另外进程的创建和撤销是动态的
>
> 端口的作用是这条信息交付到对应端口，然后再交付到对应进程

此处是软件端口，与硬件端口不同，是应用层的各个协议进程与运输实体进行层间交互的一种地址

+ 格式：16位（65535个）

  端口号只有本地意义，是标志本计算机应用层中的各个进程在和运输层交互时的层间接口，在互联网中的不用计算机中，相同的端口号没有关联

+ 类型：

  > 在信息传输过程中既需要IP地址，有要知道对应端口号

  1. 服务端使用的端口号
     1. 熟知端口号(wellknown port number)//系统端口号：数值为0 ~1023
     
        ![](https://cdn.jsdelivr.net/gh/zweix123/CS-notes@master/source/Computer-Network/常用的熟知端口号.png)
     
        > 可在网址`www.iana.org`查到
     
        是IANA指派给TCP/IP最重要的应用程序
     
     2. 登记端口号：数值为1024 ~ 49151
     
        需要在IANA上登记避免重复
     
  2. 客户端使用的端口号/短暂端口号：数值为49152 ~ 65535

# 用户数据报协议UDP

+ 特点：

  1. UDP是**无连接的**，即发送数据之前不需要建立连接，因此减少了开销和发送数据之前的时延

  2. UDP使用**尽最大努力交付**，即不保证可靠交付，因此主机不需要维持复杂的连接状态表

  3. UDP的**面向报文**的：UDP对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界

     ![](https://cdn.jsdelivr.net/gh/zweix123/CS-notes@master/source/Computer-Network/UDP面向报文.png)

     需要报文大小合适

  4. UDP**没有拥塞控制**：对于要求恒定发送速率，允许丢失一些数据的应用

     > 但也可能让网络拥塞

  5. UDP**支持一对一、一对多、多对一和多对多的交互通信**

  6. UDP的**首部开销小**：只有8个字节，比TCP的20个字节的首部要短

  > 有些程序会对UDP的不可靠通信进行改进：前向纠错或重传丢失

+ 格式：（伪首部字段12字节） + 首部字段8字节 + 数据字段

  ![](https://cdn.jsdelivr.net/gh/zweix123/CS-notes@master/source/Computer-Network/UDP数据报格式.png)

  + 首部：
    1. 源端口：源端口号。在需要对方回信时选用。不需要时可全0
    2. 目的端口：目的端口号。这在终点交付报文时必须使用
    3. 长度：UDP用户数据报的长度，其最小值是8（仅有首部）
    4. 检验和：检测UDP用户数据报在传输中是否有错。有错就丢弃

+ 说明：

  + 如果接收方UDP发现收到的报文中的目的端口号不正确就丢弃该报文，并由ICMP发送“端口不可达”差错报文给发送方

  + 检验和：把首部和数据部分一起都检验

    + 伪首部的意义是其长度算上首部正好是一个16位
    + 流程：
      1. 把UDP数据报看作多个16位的字串，检验和部分为0，不足位置为0
      2. 以二进制反码计算所有16位字串的和，写入UDP检验和部分
      3. 接收方再次求和，为1则无差错

    + 同时能检验端口号

# 传输控制协议TCP

+ 特点：

  1. TCP是**面向连接**的运输层协议：通信前建立连接，后释放连接

  2. 每一条TCP连接只能有两个**端点**(endpoint)，每一条TCP连接只能是**点对点**的（一对一）

  3. TCP提供**可靠交付**的服务。通过TCP连接传送的数据，无差错、不丢失、不重复，并且按序到达

  4. TCP提供**全双工通信**。利用缓存，是进程在任何时候都发送或读取数据，TCP负责在合适的时候发送

  5. **面向字节流**：TCP将应用进程交下来的**数据块**看成一连串无结构的**字节流**，在传输时不关心数据块的大小 -> TCP不关心数据何时/多大放到缓存里，只根据网络情况发送。

     + 流(stream)：流入到进程或从进程流出的字节序列

     **虚连接**/逻辑连接：不是物理连接

+ 连接：TCP把==连接==作为**最基本的抽象**：TCP连接两个**端点**——套接字(socket)或插口

  + 套接字：端口号*拼接到*(concatenated with)IP地址$套接字socket = (IP地址:端口号)$[RFC 793]
  + 每一条TCP连接唯一地被通信两端地两个端点（即两个套接字）所确定$TCP连接::={socket_1, socket_2}={(IP_1:port_1), (IP_2:port_2)}$
  
  > socket的其他含义：![](https://cdn.jsdelivr.net/gh/zweix123/CS-notes@master/source/Computer-Network/socket其他含义.png)

## 可靠传输

> TCP发送的报文段由IP层传送，但IP层只提供最大努力服务，TCP需要采取措施保证通信可靠

### 原理

### 实现

## 流量控制

## 拥塞控制

### 原理

### 方法

## 运输连接管理







